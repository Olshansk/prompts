## Gemini Added Memories
- The `make ghd-pre-process-images` target is implemented and fully functional, wrapping `scripts/process_ghd_data.py` to run the GHD pipeline with Surya OCR.
- The GHD pipeline now supports single-image processing via the `--image` flag in `scripts/process_ghd_data.py`, and data cleaning is modularized in `src/ghd_pipeline/steps/data_cleaner.py`.
- I've implemented robust orientation correction in `src/ghd_pipeline/steps/orientation.py` that uses EXIF data followed by Tesseract OSD (with Otsu thresholding preprocessing) to ensure images are upright based on text legibility.
- I increased the Tesseract OSD confidence threshold to 2.0 in `src/ghd_pipeline/steps/orientation.py` to prevent false positive rotations on noisy soil images, as low-confidence detection (e.g., 1.01) was causing incorrect flips.
- I've implemented a relaxed regex fallback in `src/ghd_pipeline/steps/label_reader.py` that can extract Lab IDs like `WLT1321` from messy text (e.g., `WLT1321 23-02...`), logging a "ðŸš¨ Fuzzy match" warning when this occurs.
- I've updated the regex in `src/ghd_pipeline/steps/label_reader.py` to support Lab IDs with hyphens between the prefix and number (e.g., `WLT-1349-9`).
- The images `IMG_1986.JPEG` and `IMG_2427.JPEG` are unreadable by both Surya and Tesseract OCR despite upscaling (2x), rotation (180/EXIF), preprocessing (Otsu/CLAHE), and card cropping attempts, due to low contrast and noise.
- The SQLite database `cache/followers.db` has a `followers` table with primary key `(id, followed_username)`. It stores flattened follower data including `followers_count`, `screen_name`, etc. The script `scripts/json_to_sqlite.py` populates it from `merged.json` files.
- Implemented `src/vision/smart_crop.py` which uses FastSAM (via `ultralytics`) to deterministically crop soil regions, avoiding labels and trays. It includes a fallback to texture-based sliding window. Run via `uv run python src/vision/smart_crop.py <image>`.
- Updated GHD pipeline (`scripts/process_ghd_data.py`, `src/ghd_pipeline/pipeline.py`) to use `SmartCropper` by default. It now generates 4 crops per image using FastSAM (MPS/GPU enabled). Legacy contour cropping is available via `--no-smart-crop`.
- The Grove API consists of three main areas: funding (x402 protocol), tipping (destinations: addresses, ENS, llms.txt, Twitter), and account management (balances, history). Funding is a 2-step process requiring a client-side signature. Tipping requires a JWT obtained during funding.
- The file `agent_sdk/grove.py` is a standalone Python SDK I created to simplify agent onboarding. It handles the x402 payment protocol (signing EIP-712 messages) for the `/fund` endpoint and provides simple methods for tipping and checking balances, abstracting away cryptographic complexity for agent developers.
- Updated `SmartCropper` to support `strategy="roi"` (default for pipeline), which produces a single, high-resolution crop of the entire soil region (based on segmentation mask) instead of multiple training tiles. Fixed naming convention to match legacy (`IMG_XXXX_crop.jpg`).
- Updated training configuration: ResNet backbone is now unfrozen (`FREEZE_BACKBONE=False`) and input resolution increased to 512x512. VLM System Prompt now uses a "Geotechnical Engineer" persona with Chain-of-Thought reasoning ("Field Description" before JSON).
- Added Substack integration: created `SubstackProfile` adapter using local `substack-api` library, updated `SocialPlatform` and resolver logic, added unit tests, and comprehensive E2E tests (`make test_e2e_substack`, `make test_e2e_all`). Updated project python requirement to >=3.12.
- Verified Substack adapter handles all URL formats (subdomain, path, @handle) and extracts addresses from bio, display name, and handle/username. Added comprehensive unit tests for these cases.
- Encountered DNS resolution error for 'substack.com' in user's environment, preventing E2E confirmation of Substack tipping. Code logic and unit tests are verified correct.
- Updated ResNet training pipeline: froze backbone, increased resolution to 512x512, added RandomVerticalFlip, renamed 'grain' to 'gradation' in code, and implemented K-Fold Cross Validation. Added loss weighting (10.0 for gradation, 1.0 for Atterberg).
- Unfroze ResNet backbone (FREEZE_BACKBONE=False) and switched to console.print for epoch logging to fix missing logs issue. Kept 512x512 resolution and loss weighting.
